{% extends 'tool/base.html' %}
{% load static %}

{% block css_block %}
<link rel="stylesheet" type="text/css" href="{% static 'home.css' %}">
{% endblock %}


{% block body_block %}
  <div id = "font-weight-bold">
    <h3>
      {% if car.archived %}
      <a href="{% url 'tool:car_display' car.carSlug %}"> Car: <span class="text-uppercase"></span>{{car.carName }}{{ car.carYear }} Archived </span></a> </br>
      {% else %}
          <a href="{% url 'tool:car_display' car.carSlug %}"> Car: <span class="text-uppercase"></span>{{car.carName }}{{ car.carYear }} </span></a> </br>
      {% endif %}

      {% if system %}
       System:  {{system.systemName}} </br>
        Assemblies:
      {% else %}
        <p> Invlid System</p>
      {% endif %}
    </h3>

  </div>

<div class="container-fluid">
  <div class="accordion accordion-flush">
  {% for assembly_key, parts in output.items %}
    {# Assembly row #}
    <div class="accordion-item">
      <h2 class="accordion-header" id="a{{assembly_key.assemblyID}}-heading">
        <button class="accordion-button" style="background-color:#ffcc00;color:#1f1f1f;font-size: 24px;font-weight:600" type="button" data-bs-toggle="collapse" data-bs-target="#a{{assembly_key.assemblyID}}-collapse" aria-controls="a{{assembly_key.assemblyID}}-collapse">
          {{assembly_key.assemblyName}} eng: {{assembly_key.user.user.username}}
        </button>
      </h2>
      {% if display_edit_assignees %}
      <a href="{% url 'tool:edit_assign_eng' car.carSlug system.systemSlug assembly_key.assemblySlug %}"> edit engineer </a>
      {% endif %}
        {% if access_bool|get_edit_assembly:assembly_key.pk %}
        <a href="{% url 'tool:add_part' car.carSlug system.systemSlug assembly_key.assemblySlug %}"><button class="btn"></button> Add </a>
        <a href="{% url 'tool:add_assembly' car.carSlug system.systemSlug assembly_key.assemblySlug %}"><button class="btn"></button> Edit</a>
        {% endif %}
      <div id="a{{assembly_key.assemblyID}}-collapse" class="accordion-collapse collapse" aria-labelledby="a{{assembly_key.assemblyID}}-heading">
        <div class="accordion-body border-end" style="padding:0">
          <div class="container-fluid" style="background-color:#1f1f1f;color:#ffcc00">
            <div class="row">
                  <div class="col-2">
                  </div>
                  <div class="col-1" style="font-weight: 600;">
                    M/B
                  </div>
                  <div class="col-1" style="font-weight: 600;">
                    Cost
                  </div>
                  <div class="col-1" style="font-weight: 600;">
                    Qt
                  </div>
                  <div class="col-3" style="font-weight: 600;">
                    Comment
                  </div>
                  <div class="col-1" style="font-weight: 600;">
                    edit
                  </div>
            </div>
          </div>
          <div class="accordion accordion-flush">
            {% for part_key, pmfts in parts.items %}
              {# Part row #}
              <div class="accordion-item">
                <h2 class="accordion-header" id="p{{part_key.partID}}-heading">
                  <button class="accordion-button" style="background-color:#f3f3f3;color:#1f1f1f;font-size: 24px" type="button" data-bs-toggle="collapse" data-bs-target="#p{{part_key.partID}}-collapse" aria-controls="p{{part_key.partID}}-collapse">
                    <div class="row">
                      <div class="col-2 text-center" style="font-weight: 600;">
                        {{part_key.partName}}
                      </div>
                      <div class="col-1" style="font-weight: 600;">
                        {{part_key.makeBuy}}                      
                      </div>
                      <div class="col-1" style="font-weight: 600;">
                        {{part_key.partCost}}                      
                      </div>
                      <div class="col-1" style="font-weight: 600;">
                        {{part_key.partQuantity}}                      
                      </div>
                      <div class="col-3" style="font-weight: 600;">
                        {{part_key.partComment}}                      
                      </div>   
                      <div class="col-3" style="font-weight: 600;">
                        {% if access_bool|get_edit_assembly:assembly_key.pk %}
                        <a href="{% url 'tool:add_pmft' car.carSlug system.systemSlug assembly_key.assemblySlug part_key.partSlug %}"><button class="btn"></button> Add </a>
                        <a href="{% url 'tool:add_part' car.carSlug system.systemSlug assembly_key.assemblySlug part_key.partSlug %}"><button class="btn"></button> Edit</a>
                        <a href="{% url 'tool:part_delete' car.carSlug system.systemSlug assembly_key.assemblySlug part_key.partSlug %}"><button class="btn"></button> Del </a>
                        {% endif %}               
                      </div>   
                    </div>
                  </button>  
                </h2>
                <div id="p{{part_key.partID}}-collapse" class="accordion-collapse collapse" aria-labelledby="p{{part_key.partID}}-heading">
                  <div class="accordion-body border-end" style="padding:0">
                    <div class="container-fluid" style="background-color:#1f1f1f;color:#ffcc00">
                      <div class="row">
                            <div class="col-1">
                            </div>
                            <div class="col-1" style="font-weight: 600;">
                              P/M/F/T
                            </div>
                            <div class="col-3" style="font-weight: 600;">
                              Comment
                            </div>
                            <div class="col-1 text-center" style="font-weight: 600;">
                              Qt
                            </div>
                            <div class="col-1 text-center" style="font-weight: 600;">
                              Cost
                            </div>
                            <div class="col-3" style="font-weight: 600;">
                              Cost Comment
                            </div>
                            <div class="col-1">
                            </div>
                      </div>
                    </div>
                    <div style="padding:0.75rem 1.25rem;background-color:#e8e8e8;font-size: 16px;">
                      {% for pmft in pmfts %}
                        {# PMFT row #}
                        <div class="row">
                          <div class="col-1" style="font-weight: 600;">
                            {{pmft.pmftName}}
                          </div>
                          <div class="col-1" style="font-weight: 600;">
                            {{pmft.pmftType}}
                          </div>
                          <div class="col-3" style="font-weight: 600;">
                            {{pmft.pmftComment}}
                          </div>
                          <div class="col-1 text-center" style="font-weight: 600;">
                            {{pmft.pmftQuantity}}
                          </div>
                          <div class="col-1 text-center" style="font-weight: 600;">
                            {{pmft.pmftCost}}
                          </div>
                          <div class="col-3" style="font-weight: 600;">
                            {{pmft.pmftCostComment}}
                          </div>
                            <div class="col-1" style="font-weight: 600;">
                              {% if access_bool|get_edit_assembly:assembly_key.pk %}
                              <a href="{% url 'tool:add_pmft' car.carSlug system.systemSlug assembly_key.assemblySlug part_key.partSlug pmft.pmftSlug %}"><button class="btn"></button> Edit</a>
                              <a href="{% url 'tool:pmft_delete' car.carSlug system.systemSlug assembly_key.assemblySlug part_key.partSlug pmft.pmftSlug %}"><button class="btn"></button> Del </a>
                              {% endif %}
                            </div>
                        </div>
                      {% endfor %}
                    </div>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  {% endfor %}
  </div>
</div>

{% if display_add_assembly %}
  <div class="mt-4">
    <a href="{% url 'tool:add_assembly' car.carSlug system.systemSlug %}"> CLICK HERE TO ADD ASSEMBLY</a>
  </div>
{% endif %}

  <!--</div>-->
  <div id="clear"></div>
{% endblock %}
